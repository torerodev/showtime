! Arista cEOS Leaf2 Configuration
!
! Set hostname
hostname leaf2
!
! Banner configuration
banner login 
+------------------------------------------------------------------------------+
|  WARNING: This is the MOST PRIVATE and AWESOME lab in the entire universe!   |
|                                                                              |
|  Unauthorized access is strictly prohibited and will result in:              |
|   - Your keyboard mysteriously converting to DVORAK layout                   |
|   - All your configs spontaneously translating to interpretive dance         |
|   - Network packets taking scenic routes and returning with vacation photos  |
|                                                                              |
|  Access and use are monitored by an army of caffeinated network engineers    |
|  who have nothing better to do than watch login attempts all day.            |
|                                                                              |
|  Proceed only if you have authorization... or really good snacks to share.   |
+ -----------------------------------------------------------------------------+
EOF
!
! Configure local users
username admin privilege 15 role network-admin secret admin
!
! Enable required services
service routing protocols model multi-agent
!
! Configure management interface
interface Management0
   description "Out of Band Management"
   ip address dhcp
   no shutdown
!
! Configure SSH access
management ssh
   no shutdown
   authentication mode password
   idle-timeout 60
   ip access-group MGMT-ACL in
!
! Create ACLs
ip access-list MGMT-ACL
   10 permit ip 192.168.0.0/16 any
   20 permit ip 10.0.0.0/8 any
   30 permit ip 172.16.0.0/12 any
   40 permit ip 1.1.1.0/24 any
   50 deny ip any any
!
! Configure VTY lines
line vty
   transport input ssh
   exec-timeout 30
!
! Configure system services
ip http server
ip http secure-server
ip http client source-interface Management0
!
! Configure system settings
clock timezone UTC
ip domain lookup
ip icmp rate-limit unreachable 100
!
! Configure DNS
ip name-server 8.8.8.8
ip name-server 8.8.4.4
ip domain-name example.com
!
! Configure NTP
ntp server 0.pool.ntp.org prefer
ntp server 1.pool.ntp.org
ntp source Management0
!
! Configure logging
logging console informational
logging monitor informational
logging buffered 10000 informational
logging host 192.168.1.100
logging source-interface Management0
!
! Configure SNMP
snmp-server community public ro
snmp-server community private rw
snmp-server location "Data Center 1, Rack 2"
snmp-server contact "Network Operations Center <noc@example.com>"
!
! Enable routing
ip routing
!
! Configure Loopback for BGP Router ID and VTEP
interface Loopback0
   description "BGP Router ID"
   ip address 10.0.1.2/32
!
interface Loopback1
   description "VTEP IP"
   ip address 10.0.2.2/32
!
! Configure Leaf-to-Spine interfaces (Layer 3)
interface Ethernet1
   description "Link to spine1"
   no switchport
   ip address 10.1.1.3/31
   mtu 9214
   no shutdown
!
interface Ethernet2
   description "Link to spine2"
   no switchport
   ip address 10.2.1.3/31
   mtu 9214
   no shutdown
!
! Configure VLANs for local segments
vlan 10
   name TENANT_A_WEB
!
vlan 20
   name TENANT_A_APP
!
vlan 30
   name TENANT_B_WEB
!
vlan 40
   name TENANT_B_APP
!
! Configure VRFs for tenants
vrf instance TENANT_A
   rd 10.0.1.2:1
!
vrf instance TENANT_B
   rd 10.0.1.2:2
!
! Configure SVIs for VLANs
interface Vlan10
   description "Tenant A Web Tier"
   vrf TENANT_A
   ip address virtual 192.168.10.1/24
   no shutdown
!
interface Vlan20
   description "Tenant A App Tier"
   vrf TENANT_A
   ip address virtual 192.168.20.1/24
   no shutdown
!
interface Vlan30
   description "Tenant B Web Tier"
   vrf TENANT_B
   ip address virtual 192.168.30.1/24
   no shutdown
!
interface Vlan40
   description "Tenant B App Tier"
   vrf TENANT_B
   ip address virtual 192.168.40.1/24
   no shutdown
!
! Configure VXLAN
interface Vxlan1
   vxlan source-interface Loopback1
   vxlan udp-port 4789
   vxlan vlan 10 vni 10010
   vxlan vlan 20 vni 10020
   vxlan vlan 30 vni 10030
   vxlan vlan 40 vni 10040
   vxlan vrf TENANT_A vni 50001
   vxlan vrf TENANT_B vni 50002
!
! Configure access ports for end hosts
interface Ethernet3
   description "Host in VLAN 10"
   switchport access vlan 10
   switchport mode access
   spanning-tree portfast
   no shutdown
!
interface Ethernet4
   description "Host in VLAN 30"
   switchport access vlan 30
   switchport mode access
   spanning-tree portfast
   no shutdown
!
! BGP Configuration
router bgp 65202
   router-id 10.0.1.2
   no bgp default ipv4-unicast
   maximum-paths 4 ecmp 4
   distance bgp 20 200 200
   !
   neighbor SPINE_UNDERLAY peer group
   neighbor SPINE_UNDERLAY remote-as 65100
   neighbor SPINE_UNDERLAY send-community extended
   !
   neighbor 10.1.1.2 peer group SPINE_UNDERLAY
   neighbor 10.1.1.2 description spine1
   !
   neighbor 10.2.1.2 peer group SPINE_UNDERLAY
   neighbor 10.2.1.2 description spine2
   !
   neighbor SPINE_OVERLAY peer group
   neighbor SPINE_OVERLAY remote-as 65100
   neighbor SPINE_OVERLAY update-source Loopback0
   neighbor SPINE_OVERLAY ebgp-multihop 3
   neighbor SPINE_OVERLAY send-community extended
   !
   neighbor 10.0.0.1 peer group SPINE_OVERLAY
   neighbor 10.0.0.1 description spine1_overlay
   !
   neighbor 10.0.0.2 peer group SPINE_OVERLAY
   neighbor 10.0.0.2 description spine2_overlay
   !
   vlan 10
      rd 10.0.1.2:10010
      route-target both 1:10010
      redistribute learned
   !
   vlan 20
      rd 10.0.1.2:10020
      route-target both 1:10020
      redistribute learned
   !
   vlan 30
      rd 10.0.1.2:10030
      route-target both 1:10030
      redistribute learned
   !
   vlan 40
      rd 10.0.1.2:10040
      route-target both 1:10040
      redistribute learned
   !
   address-family evpn
      neighbor SPINE_OVERLAY activate
   !
   address-family ipv4
      neighbor SPINE_UNDERLAY activate
      network 10.0.1.2/32
      network 10.0.2.2/32
   !
   vrf TENANT_A
      rd 10.0.1.2:1
      route-target import evpn 1:50001
      route-target export evpn 1:50001
      redistribute connected
   !
   vrf TENANT_B
      rd 10.0.1.2:2
      route-target import evpn 1:50002
      route-target export evpn 1:50002
      redistribute connected
!
! Enable features
lldp run
!
! Configure MLAG (optional for future expansion)
spanning-tree mode mstp
!
! IP virtual router MAC address
ip virtual-router mac-address 00:1c:73:00:00:01
!
! Save configuration
copy running-config startup-config